{
  "features": [
    {
      "id": "workforce.capacity_dashboard",
      "name": "Workforce Capacity Dashboard",
      "description": "Dashboard showing available capacity vs required care hours by role, service type, and provider type.",
      "status": "done",
      "acceptance_criteria": [
        "Capacity endpoint no longer crashes (fixed riskFlags and duration query)",
        "WorkforceCapacityService computes available hours from staff availability",
        "Required hours computed from care bundle requirements",
        "Net capacity = available - required - travel overhead",
        "Travel overhead uses default 30 min or actual travel times",
        "API endpoint /api/v2/workforce/capacity returns non-zero summary and breakdowns",
        "Breakdowns by role, service type, provider type (SPO/SSPO)",
        "React dashboard with period selector (week/month)",
        "Summary cards: total available, required, net capacity, travel overhead",
        "Table breakdown by role and service type",
        "Sidebar link for SPO admin/coordinator"
      ],
      "files": [
        "app/Services/CareOps/WorkforceCapacityService.php",
        "app/Http/Controllers/Api/V2/WorkforceController.php",
        "resources/js/pages/CareOps/WorkforceCapacityPage.jsx",
        "resources/js/components/App.jsx"
      ]
    },
    {
      "id": "scheduling.patient_non_concurrency",
      "name": "Patient Non-Concurrency",
      "description": "A patient must never have two visits at the same time by default. PT & OT cannot be scheduled for the same patient at the same time.",
      "status": "done",
      "acceptance_criteria": [
        "Patient-level overlap detection via patientHasOverlap($patient, $start, $end, $ignoreAssignmentId)",
        "Integrated into Assignment creation/update API endpoints",
        "PT & OT cannot be scheduled for the same patient at the same time",
        "Patient timeline never shows two blocks overlapping",
        "Tests for overlapping PT/OT visits rejection",
        "Tests for non-overlapping visits allowed"
      ],
      "files": [
        "app/Services/Scheduling/SchedulingEngine.php",
        "app/Http/Controllers/Api/V2/SchedulingController.php",
        "tests/Feature/PatientNonConcurrencyTest.php"
      ]
    },
    {
      "id": "scheduling.psw_spacing",
      "name": "PSW Spacing Rules",
      "description": "PSW/personal care visits should be spaced across the day, not bunched. Minimum 120 minutes between PSW visits for the same patient.",
      "status": "done",
      "acceptance_criteria": [
        "ServiceType has min_gap_between_visits_minutes field",
        "PSW: 120 min, Nursing: 60 min default",
        "Enforced in SchedulingEngine validation",
        "Applied during assignment creation/update",
        "Seeding places PSW visits in morning/midday/afternoon bands",
        "Tests for PSW visits too close together",
        "Tests for well-spaced PSW visits"
      ],
      "files": [
        "app/Models/ServiceType.php",
        "app/Services/Scheduling/SchedulingEngine.php",
        "database/seeders/CoreDataSeeder.php",
        "tests/Feature/SpacingRulesTest.php"
      ]
    },
    {
      "id": "scheduling.patient_timeline_correctness",
      "name": "Patient Timeline Correctness",
      "description": "Patient-centric view is a clean time-based list, no overlaps, no staff-row clutter.",
      "status": "done",
      "acceptance_criteria": [
        "Timeline queries ONLY this patient's ServiceAssignments",
        "Visits are sorted by start time",
        "No staff rows; each row is a visit with time, service, and staff info",
        "Single-column or clear day-based list",
        "Not cluttered with staff rows"
      ],
      "files": [
        "resources/js/components/scheduling/PatientTimeline.jsx"
      ]
    },
    {
      "id": "bundles.unscheduled_care_correctness",
      "name": "Unscheduled Care Correctness",
      "description": "Unscheduled Care panel must correctly show patients who need scheduled care based on their care bundle requirements.",
      "status": "done",
      "acceptance_criteria": [
        "Computes required_units from CareBundleService (hours/week or visits/week)",
        "Computes scheduled_units from ServiceAssignments in the selected week",
        "remaining_units = max(required_units - scheduled_units, 0)",
        "For RPM: uses fixed_visits logic (2 visits per plan)",
        "API returns all patient+service combinations with remaining > 0",
        "FE shows 'All required care scheduled' only when API returns empty",
        "Seeded data ensures some patients have unscheduled care in current/future weeks for demo"
      ],
      "files": [
        "app/Services/Scheduling/CareBundleAssignmentPlanner.php",
        "app/DTOs/RequiredAssignmentDTO.php",
        "app/DTOs/UnscheduledServiceDTO.php",
        "app/Http/Controllers/Api/V2/SchedulingController.php",
        "database/seeders/VisitVerificationSeeder.php"
      ]
    },
    {
      "id": "rpm.fixed_two_visits",
      "name": "RPM Fixed Two Visits",
      "description": "RPM service type uses fixed_visits_per_plan mode with 2 visits total per care plan.",
      "status": "done",
      "acceptance_criteria": [
        "ServiceType has scheduling_mode = 'fixed_visits'",
        "fixed_visits_per_plan = 2 for RPM",
        "Tracked across entire care plan, not per week",
        "CareBundleAssignmentPlanner calculates remaining visits correctly"
      ],
      "files": [
        "app/Models/ServiceType.php",
        "app/Services/Scheduling/CareBundleAssignmentPlanner.php",
        "database/seeders/CoreDataSeeder.php"
      ]
    },
    {
      "id": "scheduling.quick_navigation",
      "name": "Quick Navigation Selection",
      "description": "Quick Navigation allows choosing specific staff or patient instead of hardcoded examples.",
      "status": "not_started",
      "acceptance_criteria": [
        "Staff-Centric View shows dropdown to select any active staff member",
        "Patient-Centric View shows dropdown to select any active patient",
        "Selected staff navigates to /spo/scheduling?staff_id={id}",
        "Selected patient navigates to /spo/scheduling?patient_id={id}",
        "Full Dashboard clears all filters",
        "No hardcoded staff or patient IDs",
        "Selection persists via URL params"
      ],
      "files": [
        "resources/js/pages/CareOps/SchedulingPage.jsx",
        "app/Http/Controllers/Api/V2/SchedulingController.php"
      ]
    },
    {
      "id": "ui.scheduler_layout",
      "name": "Scheduler Layout - Unscheduled Care Above Grid",
      "description": "Unscheduled Care panel should be above the calendar grid for better viewport utilization.",
      "status": "not_started",
      "acceptance_criteria": [
        "Unscheduled Care panel is positioned above the calendar grid",
        "Calendar grid has full viewport width",
        "Unscheduled Care panel is collapsible or scrollable horizontally",
        "Responsive layout still works on smaller screens",
        "Both panel and grid are visible without excessive scrolling"
      ],
      "files": [
        "resources/js/pages/CareOps/SchedulingPage.jsx"
      ]
    },
    {
      "id": "sspo.scheduling_integration",
      "name": "SSPO Scheduling Dashboard Separation",
      "description": "SPO and SSPO scheduling dashboards are properly separated with correct access.",
      "status": "not_started",
      "acceptance_criteria": [
        "SPO admins see SPO scheduling at /spo/scheduling (their internal staff + SSPOs serving them)",
        "SSPO admins see SSPO scheduling at /sspo/scheduling (their own staff)",
        "SPO admins do NOT see SSPO admin dashboard",
        "Quick Navigation includes SSPO staff as selectable for SPO admins",
        "Route guards enforce proper access"
      ],
      "files": [
        "resources/js/pages/CareOps/SchedulingPage.jsx",
        "resources/js/components/App.jsx",
        "routes/web.php"
      ]
    },
    {
      "id": "sspo.assignment_prioritization",
      "name": "SSPO vs SPO Service Ownership",
      "description": "Certain services are preferentially assigned to SSPOs vs SPO internal staff.",
      "status": "not_started",
      "acceptance_criteria": [
        "ServiceType has preferred_provider metadata (SPO/SSPO/either)",
        "Lifeline/PERS, RPM, Security Checks, Behavioural Supports, In-Home Lab, Pharmacy, Meal Delivery \u2192 SSPO preferred",
        "Core nursing/PSW/OT/PT \u2192 SPO preferred or 'either'",
        "Assign-Care workflow shows provider type choice informed by ServiceType.preferred_provider",
        "SSPOs shown by default for SSPO-preferred services",
        "SPO staff prioritized for SPO-preferred services",
        "No hardcoded service lists"
      ],
      "files": [
        "app/Models/ServiceType.php",
        "database/seeders/CoreDataSeeder.php",
        "resources/js/components/scheduling/AssignCareServiceModal.jsx"
      ]
    },
    {
      "id": "intake.queue_status_standardization",
      "name": "Queue Status Badge Standardization",
      "description": "Patient queue badges use standardized InterRAI HC assessment status labels.",
      "status": "done",
      "acceptance_criteria": [
        "Status: InterRAI HC Required (for all pending/in-progress assessments)",
        "Status: InterRAI HC Complete (for completed assessments ready for bundle)",
        "Only 2 standardized labels used across all views",
        "Badge colors: amber/yellow for Required, green for Complete",
        "Driven by PatientQueue.php constants and INTERRAI_STATUS_MAP",
        "Frontend uses interrai_status and interrai_badge_color from API"
      ],
      "files": [
        "app/Models/PatientQueue.php",
        "resources/js/pages/Patients/PatientsList.jsx"
      ]
    },
    {
      "id": "jeopardy.visit_verification_workflow",
      "name": "Visit Verification Threshold & Resolve",
      "description": "Visit verification overdue threshold matches RFP/Q&A and Resolve button works correctly.",
      "status": "done",
      "acceptance_criteria": [
        "Overdue threshold is 12 hours after visit completion (per RFP/Q&A), not 24 hours",
        "Resolve button marks ServiceAssignment.verification_status = VERIFIED",
        "Resolve sets verified_at = now()",
        "Jeopardy count updates immediately after resolve",
        "Missed Care Rate recomputes after resolve",
        "Seeded data has 3-10 overdue visits for demo, not excessive"
      ],
      "files": [
        "app/Services/CareOps/VisitVerificationService.php",
        "app/Services/CareOps/JeopardyBoardService.php",
        "resources/js/pages/CareOps/CareDashboardPage.jsx",
        "database/seeders/VisitVerificationSeeder.php"
      ]
    },
    {
      "id": "profile.service_history_and_upcoming",
      "name": "Patient Profile Service History & Upcoming",
      "description": "Patient profile shows upcoming service appointments and full service history.",
      "status": "not_started",
      "acceptance_criteria": [
        "Overview tab shows 'Upcoming Service Appointments' for today and tomorrow",
        "New 'Service History' tab after Notes/Narrative",
        "Service History shows upcoming appointments (configurable days ahead)",
        "Service History shows completed visits sorted by date",
        "Each visit shows: time, service type, staff, verification status",
        "Paginated if needed",
        "Uses existing metadata for ServiceType, staff"
      ],
      "files": [
        "resources/js/pages/Patients/PatientDetailPage.jsx",
        "app/Http/Controllers/Api/PatientController.php"
      ]
    },
    {
      "id": "profile.satisfaction_reports",
      "name": "Patient Profile Satisfaction Reports",
      "description": "Satisfaction reports are visible on patient profile.",
      "status": "not_started",
      "acceptance_criteria": [
        "SatisfactionReport model exists or alternative tracking visible",
        "Patient profile shows most recent satisfaction rating",
        "Link to full satisfaction report details if available",
        "Section in Service History or separate panel"
      ],
      "files": [
        "app/Models/User.php",
        "resources/js/pages/Patients/PatientDetailPage.jsx"
      ]
    },
    {
      "id": "metrics.fte_trend_and_utilization",
      "name": "FTE Trend Graph Population",
      "description": "FTE compliance trend graph populates with real data.",
      "status": "not_started",
      "acceptance_criteria": [
        "FTE ratio = FT direct staff / (FT + PT + Casual direct staff) per week",
        "Last 8 weeks of data shown in trend chart",
        "Data computed from seeded StaffMember & assignments",
        "Chart renders with actual values, not flat/empty",
        "Color-coded bands: Green >=80%, Yellow 75-79%, Red <75%"
      ],
      "files": [
        "app/Services/CareOps/FteComplianceService.php",
        "resources/js/pages/Workforce/WorkforceManagementPage.jsx",
        "database/seeders/WorkforceSeeder.php"
      ]
    },
    {
      "id": "command_center.tiles_and_deep_links",
      "name": "Command Center Metrics & Deep Links",
      "description": "Command Center shows all OHAH-required metrics with working deep links.",
      "status": "not_started",
      "acceptance_criteria": [
        "Referral Acceptance Rate tile with real data",
        "Time-to-First-Service tile with real data",
        "Missed Care Rate tile (0% target)",
        "Direct Care FTE tile with green/amber/red banding",
        "Tile clicks navigate: Missed Care \u2192 Jeopardy, TFS \u2192 patients needing first visit, FTE \u2192 Workforce page",
        "Metrics backed by real queries, not stubbed"
      ],
      "files": [
        "resources/js/pages/CareOps/CareDashboardPage.jsx",
        "app/Services/CareOpsMetricsService.php"
      ]
    },
    {
      "id": "seeding.historical_assignments_realism",
      "name": "Realistic Historical ServiceAssignments",
      "description": "Seeded ServiceAssignments have varied dates and realistic patterns.",
      "status": "done",
      "acceptance_criteria": [
        "Service durations match ServiceType metadata, no 8-hour mega-visits",
        "Start dates vary across past weeks",
        "RPM Setup visits near plan start dates",
        "RPM Discharge visits near plan end dates",
        "Staff travel + spacing rules remain valid",
        "SSPO-preferred services assigned to SSPO staff",
        "Past 3 weeks mostly fully scheduled",
        "Current week 60-80% scheduled with 20-40% intentionally unscheduled",
        "Future weeks show more unscheduled care"
      ],
      "files": [
        "database/seeders/VisitVerificationSeeder.php",
        "database/seeders/WorkforceSeeder.php"
      ]
    },
    {
      "id": "bundles.plan_vs_schedule_separation",
      "name": "Bundle Plan vs Schedule Separation",
      "description": "Bundle creation/publish creates care plan without auto-assigning staff. Scheduling happens separately.",
      "status": "done",
      "acceptance_criteria": [
        "New care plan publish creates CareBundleServices only, not ServiceAssignments",
        "All services in new bundle show up as remaining care in /requirements",
        "Modify bundle: unchanged services keep existing future assignments",
        "Modify bundle: removed services cancel future ServiceAssignments",
        "Modify bundle: added services appear as unscheduled care",
        "No 'assign staff' dropdowns in bundle builder UI",
        "Scheduling happens in scheduler, not in bundle builder"
      ],
      "files": [
        "app/Services/CareBundleBuilderService.php",
        "app/Http/Controllers/Api/V2/CareBundleBuilderController.php",
        "resources/js/pages/CarePlanning/CareBundleWizard.jsx"
      ]
    },
    {
      "id": "scheduling.unscheduled_panel_ui",
      "name": "Unscheduled Care Panel UI Wiring",
      "description": "Unscheduled Care panel correctly displays remaining care from /requirements API.",
      "status": "done",
      "acceptance_criteria": [
        "Panel calls /v2/scheduling/requirements with correct date range",
        "Non-empty response shows patient cards with remaining care",
        "Empty response shows 'All required care scheduled' message",
        "Past weeks show empty or near-empty (most care scheduled)",
        "Current week shows some unscheduled items",
        "Future weeks show more unscheduled items",
        "Panel refreshes after assignments are created",
        "No filters hide valid unscheduled care items"
      ],
      "files": [
        "resources/js/pages/CareOps/SchedulingPage.jsx",
        "app/Http/Controllers/Api/V2/SchedulingController.php"
      ]
    },
    {
      "id": "nav.staff_page_renaming",
      "name": "Staff Page Renaming & Consolidation",
      "description": "Rename SPO Staff to Staff Mgmt, remove redundant Workforce Mgmt page.",
      "status": "done",
      "acceptance_criteria": [
        "Sidebar label 'SPO Staff' renamed to 'Staff Mgmt'",
        "Redundant 'Workforce Mgmt' page removed from sidebar",
        "Route /workforce removed or redirects to /workforce/capacity",
        "All workforce metrics consolidated into Capacity Dashboard",
        "Navigation is cleaner with no redundant entries"
      ],
      "files": [
        "resources/js/components/Navigation/Sidebar.jsx",
        "resources/js/components/App.jsx"
      ]
    },
    {
      "id": "sspo.marketplace_basic",
      "name": "SSPO Marketplace Directory",
      "description": "Directory listing of SSPO partners with search, filtering, and basic profile cards.",
      "status": "done",
      "acceptance_criteria": [
        "SspoMarketplacePage shows list of SSPOs from database (not mock data)",
        "SSPOCard shows: logo/initials, name, description snippet, service tags, region, status",
        "Filter by ServiceType(s), Region, status (active/draft)",
        "Text search by SSPO name/description",
        "View Profile button navigates to SSPO profile page",
        "API endpoint GET /api/v2/sspo-marketplace returns paginated SSPO list with filters",
        "Sidebar navigation link for SPO Admin/Coordinator"
      ],
      "files": [
        "resources/js/pages/CarePlanning/SspoMarketplacePage.jsx",
        "app/Http/Controllers/Api/V2/SspoMarketplaceController.php",
        "routes/api.php"
      ]
    },
    {
      "id": "sspo.profile_page",
      "name": "SSPO Profile Page",
      "description": "Rich profile page for SSPO organizations with services, contact info, and capacity.",
      "status": "done",
      "acceptance_criteria": [
        "SspoProfilePage at /sspo-marketplace/:id shows full SSPO details",
        "Header: logo, name, status badge, region",
        "About section with full description and notes",
        "Contact & Website section",
        "Services Offered section showing mapped ServiceTypes with delivery_mode",
        "Capacity section showing current capacity level",
        "Assign Service button (stub for future scheduling integration)",
        "API endpoint GET /api/v2/sspo-marketplace/:id returns full SSPO profile"
      ],
      "files": [
        "resources/js/pages/CarePlanning/SspoProfilePage.jsx",
        "app/Http/Controllers/Api/V2/SspoMarketplaceController.php",
        "resources/js/components/App.jsx"
      ]
    },
    {
      "id": "sspo.profile_seed",
      "name": "SSPO Profile Seeder",
      "description": "Seed 4 SSPO organizations: Alexis Lodge, Reconnect, Toronto Grace RCM, WellHaus.",
      "status": "done",
      "acceptance_criteria": [
        "SSPOSeeder creates 4 SSPO organizations with complete data",
        "Alexis Lodge: dementia care, behavioural supports, PSW, respite",
        "Reconnect: home help, respite, meals, behavioural, case management",
        "Toronto Grace RCM: PERS, RPM, medication dispensing, fall monitoring",
        "WellHaus: virtual care, lab services, telemedicine",
        "Each SSPO has region_code, service type mappings, contact info",
        "Pivot table organization_service_types populated correctly"
      ],
      "files": [
        "database/seeders/SSPOSeeder.php",
        "database/seeders/DatabaseSeeder.php"
      ]
    },
    {
      "id": "metadata.service_provider_type",
      "name": "ServiceType Provider Metadata",
      "description": "ServiceType metadata for allowed/preferred provider types and delivery mode.",
      "status": "done",
      "acceptance_criteria": [
        "ServiceType has allowed_provider_types JSON field",
        "ServiceType has preferred_provider field (spo/sspo/either)",
        "ServiceType has delivery_mode field (in_person/remote/either)",
        "PERS/RPM/Meals/Security Checks set to SSPO preferred",
        "Core nursing/PSW/OT/PT set to SPO preferred or either",
        "Methods isSspoOwned() and isSpoOwned() use new metadata",
        "SSPOSeeder populates provider metadata for SSPO-specific services"
      ],
      "files": [
        "app/Models/ServiceType.php",
        "database/migrations/2025_11_30_220100_add_provider_metadata_to_service_types.php",
        "database/seeders/SSPOSeeder.php"
      ]
    },
    {
      "id": "sspo.profile_assigned_patients",
      "name": "SSPO Profile - Assigned Patients & Appointments",
      "description": "Show patients assigned to SSPO with upcoming appointments on profile page.",
      "status": "done",
      "acceptance_criteria": [
        "API returns upcoming_assignments for SSPO (next 7 days)",
        "Assignments grouped by patient with appointment details",
        "Shows: patient name, service type, date/time, staff assigned",
        "UI section 'Assigned Patients & Appointments' in left column",
        "Empty state shows 'No upcoming appointments'",
        "Card design with patient avatar, service pill badges"
      ],
      "files": [
        "app/Http/Controllers/Api/V2/SspoMarketplaceController.php",
        "resources/js/pages/CarePlanning/SspoProfilePage.jsx"
      ]
    },
    {
      "id": "sspo.profile_service_history",
      "name": "SSPO Profile - Recent Service History",
      "description": "Show recent completed service assignments on SSPO profile page.",
      "status": "done",
      "acceptance_criteria": [
        "API returns recent_assignments for SSPO (past 7 days)",
        "Shows: patient name, service type, date/time, verification status",
        "Completed visits with checkmark icon",
        "UI section 'Recent Service History' in left column below appointments",
        "Empty state shows 'No recent service history'",
        "Condensed list view with service type color coding"
      ],
      "files": [
        "app/Http/Controllers/Api/V2/SspoMarketplaceController.php",
        "resources/js/pages/CarePlanning/SspoProfilePage.jsx"
      ]
    },
    {
      "id": "sspo.profile_capacity_block",
      "name": "SSPO Profile - Enhanced Capacity Block",
      "description": "Enhanced capacity visualization with utilization metrics on SSPO profile.",
      "status": "done",
      "acceptance_criteria": [
        "API returns capacity_summary with scheduled_hours, available_hours, utilization_pct",
        "Visual progress bar showing utilization",
        "Weekly hours breakdown",
        "Status indicator: High/Moderate/Low availability",
        "Numeric metrics: assigned patients count, weekly visit count",
        "Teal accent color for capacity indicators"
      ],
      "files": [
        "app/Http/Controllers/Api/V2/SspoMarketplaceController.php",
        "resources/js/pages/CarePlanning/SspoProfilePage.jsx"
      ]
    },
    {
      "id": "metrics.referral_acceptance",
      "name": "Referral Acceptance Rate Metric",
      "description": "Data-driven Referral Acceptance Rate metric for SPO Command Center dashboard.",
      "status": "done",
      "acceptance_criteria": [
        "PatientQueue model extended with accepted_at, is_accepted, rejection_reason fields",
        "Migration adds acceptance tracking to patient_queue table",
        "ReferralMetricsDTO and ReferralMetricsService created",
        "Rate = (accepted referrals / total referrals) * 100 over 28-day window",
        "Band calculation: A (100%), B (95-99.9%), C (<95%)",
        "SpoDashboardController includes referral_acceptance in kpi response",
        "React CareDashboardPage reads from API, not hard-coded value",
        "Band determines badge color (green/amber/rose) and left border styling",
        "Subtext shows accepted/total counts dynamically",
        "DemoPatientsSeeder sets acceptance data: 13/15 accepted = 86.67% = Band C",
        "QinSeeder uses Referral Acceptance breach for demo QIN"
      ],
      "files": [
        "database/migrations/2025_12_02_000002_add_acceptance_tracking_to_patient_queue.php",
        "app/Models/PatientQueue.php",
        "app/DTOs/ReferralMetricsDTO.php",
        "app/Services/ReferralMetricsService.php",
        "app/Http/Controllers/Api/V2/SpoDashboardController.php",
        "resources/js/pages/CareOps/CareDashboardPage.jsx",
        "database/seeders/DemoPatientsSeeder.php",
        "database/seeders/QinSeeder.php"
      ]
    },
    {
      "id": "metrics.time_to_first_service",
      "name": "Time-to-First-Service Metric",
      "description": "Data-driven Time-to-First-Service metric for SPO Command Center dashboard.",
      "status": "done",
      "acceptance_criteria": [
        "TfsMetricsService created with calculate() method",
        "TfsMetricsDTO created with band calculation (A<24h, B 24-48h, C >48h)",
        "Calculates time from PatientQueue.accepted_at to first completed ServiceAssignment",
        "Returns average hours, median hours, and patient counts",
        "SpoDashboardController includes time_to_first_service in kpi response",
        "React CareDashboardPage reads from API (data?.kpi?.time_to_first_service)",
        "Dynamic text color, badge, and formatted value based on band",
        "Seeded data shows ~16h average (Band A - Meets Target)"
      ],
      "files": [
        "app/DTOs/TfsMetricsDTO.php",
        "app/Services/TfsMetricsService.php",
        "app/Http/Controllers/Api/V2/SpoDashboardController.php",
        "resources/js/pages/CareOps/CareDashboardPage.jsx"
      ]
    },
    {
      "id": "metrics.active_qins",
      "name": "Active QINs Metric",
      "description": "Data-driven Active QINs count for SPO Command Center dashboard.",
      "status": "done",
      "acceptance_criteria": [
        "QinRecord model created with status, indicator, band_breach fields",
        "QinService provides getActiveCount, getActiveQinRecords, calculatePotentialBreaches",
        "Active QINs from persistent storage (officially issued)",
        "Potential QINs from auto-calculated metric breaches",
        "Target is 0 active QINs (green = 0, red = 1+)",
        "SpoDashboardController includes active_qins and potential_qins in response",
        "React dashboard reads count from API, no hardcoded defaults",
        "QIN Manager page uses API data instead of mock data",
        "QinSeeder creates 1 demo QIN for realistic demo",
        "OHaH webhook stub endpoint ready for future integration"
      ],
      "files": [
        "app/Models/QinRecord.php",
        "app/Services/QinService.php",
        "app/Http/Controllers/Api/V2/QinController.php",
        "app/Http/Controllers/Api/V2/SpoDashboardController.php",
        "database/migrations/2025_12_02_000001_create_qin_records_table.php",
        "database/seeders/QinSeeder.php",
        "resources/js/pages/CareOps/CareDashboardPage.jsx",
        "resources/js/pages/Compliance/QinManagerPage.jsx"
      ]
    },
    {
      "id": "ui.collapsible_sidebar",
      "name": "Collapsible Sidebar Navigation",
      "description": "Sidebar uses drawer/overlay pattern that can be toggled open/closed.",
      "status": "done",
      "acceptance_criteria": [
        "Hamburger menu button in navbar toggles sidebar open/closed",
        "Close button (X) in sidebar header closes sidebar",
        "Backdrop overlay with blur effect when sidebar is open",
        "Sidebar slides in/out with smooth transition",
        "Works consistently on all screen sizes"
      ],
      "files": [
        "resources/js/components/Layout/AppLayout.jsx",
        "resources/js/components/Navigation/Sidebar.jsx"
      ]
    },
    {
      "id": "ui.consistent_page_spacing",
      "name": "Consistent Page Spacing",
      "description": "All pages have standardized vertical spacing from top navigation bar.",
      "status": "done",
      "acceptance_criteria": [
        "All pages use py-12 (48px) standard padding",
        "Page titles align consistently below top navigation bar",
        "No one-off margin fixes in individual pages",
        "Works with fixed top navigation bar"
      ],
      "files": [
        "resources/js/pages/CareOps/CareDashboardPage.jsx",
        "resources/js/pages/CareOps/WorkforceManagementPage.jsx",
        "resources/js/pages/CareOps/WorkforceCapacityPage.jsx",
        "resources/js/pages/CarePlanning/SspoMarketplacePage.jsx",
        "resources/js/pages/Compliance/QinManagerPage.jsx",
        "resources/js/pages/Patients/PatientsList.jsx",
        "resources/js/pages/InterRAI/InterraiDashboardPage.jsx"
      ]
    },
    {
      "id": "ui.navbar_redesign",
      "name": "Navigation Bar Redesign",
      "description": "Top navigation bar with text-based logo, Dashboard button, and reorganized layout.",
      "status": "done",
      "acceptance_criteria": [
        "Text-based 'CONNECTED CAPACITY' logo replaces building icon",
        "Dashboard button for quick navigation to SPO Command Center",
        "Search bar positioned on left side",
        "Logo positioned on right side (before user info)",
        "Consistent with overall design language"
      ],
      "files": [
        "resources/js/components/Layout/AppLayout.jsx",
        "resources/js/components/Navigation/Sidebar.jsx"
      ]
    },
    {
      "id": "scheduling.ai_auto_assign",
      "name": "AI-Assisted Scheduling Engine",
      "description": "Rules-driven + LLM-powered engine that analyzes unscheduled care and proposes optimal staff-to-service assignments with human-readable explanations.",
      "status": "done",
      "acceptance_criteria": [
        "\u2705 Phase 1 Infrastructure: Vertex AI client with ADC authentication",
        "\u2705 Phase 1 Infrastructure: Configuration via environment variables",
        "\u2705 Phase 1 Infrastructure: Rate limiting and retry logic",
        "\u2705 Phase 1 Infrastructure: Audit log table (no PHI stored)",
        "\u2705 Phase 2: PromptBuilder with PII masking rules",
        "\u2705 Phase 2: RulesBasedExplanationProvider fallback",
        "\u2705 Phase 2: LlmExplanationService orchestrator",
        "\u2705 Phase 3: StaffScoringService with weighted scoring algorithm",
        "\u2705 Phase 3: ContinuityService for historical assignment lookup",
        "\u2705 Phase 3: AutoAssignEngine generates AssignmentSuggestionDTOs",
        "\u2705 Phase 3: acceptSuggestion() and acceptBatch() methods",
        "\u2705 Phase 4: API endpoints for suggestions, explain, accept",
        "\u2705 Phase 5: UI - Auto Assign button in Unscheduled Care panel",
        "\u2705 Phase 5: UI - Suggestion rows with Accept/Manual/Explain actions",
        "\u2705 Phase 5: UI - Explanation modal with detailed reasoning",
        "\u2b1c Future: Batch accept UI"
      ],
      "files": [
        "config/vertex_ai.php",
        "app/Services/Llm/VertexAi/VertexAiConfig.php",
        "app/Services/Llm/VertexAi/VertexAiClient.php",
        "app/Services/Llm/Exceptions/VertexAiException.php",
        "app/Services/Llm/Exceptions/VertexAiTimeoutException.php",
        "app/Services/Llm/Exceptions/VertexAiRateLimitException.php",
        "app/Services/Llm/Exceptions/VertexAiAuthException.php",
        "app/Services/Llm/PromptBuilder.php",
        "app/Services/Llm/Fallback/RulesBasedExplanationProvider.php",
        "app/Services/Llm/LlmExplanationService.php",
        "app/Services/Llm/DTOs/ExplanationResponseDTO.php",
        "app/Services/Llm/Contracts/ExplanationProviderInterface.php",
        "app/Services/Scheduling/ContinuityService.php",
        "app/Services/Scheduling/StaffScoringService.php",
        "app/Services/Scheduling/AutoAssignEngine.php",
        "app/Services/Scheduling/DTOs/AssignmentSuggestionDTO.php",
        "app/Http/Controllers/Api/V2/AutoAssignController.php",
        "database/migrations/2025_12_02_111344_create_llm_explanation_logs_table.php",
        "resources/js/hooks/useAutoAssign.js",
        "resources/js/components/scheduling/ExplanationModal.jsx",
        "resources/js/components/scheduling/SuggestionRow.jsx",
        "resources/js/pages/CareOps/SchedulingPage.jsx"
      ]
    },
    {
      "id": "bundles.ai_bundle_engine",
      "name": "AI-Assisted Bundle Engine",
      "description": "Intelligent, patient-experience-oriented bundle scenario generation using PatientNeedsProfile abstraction, InterRAI CA algorithms, CAP triggers, and dynamic scenario axes. Three-tier architecture: Basic Bundle → Standardized Clinical Logic → AI-Augmented.",
      "status": "in_progress",
      "version": "2.2.0",
      "architecture": {
        "tier_1": "Basic Bundle Generation (PatientNeedsProfile, Scenario Generator, Templates)",
        "tier_2": "Standardized Clinical Logic (InterRAI CA Algorithms, CAP Triggers, Service Intensity Matrix)",
        "tier_3": "AI-Augmented (Vertex AI Explanation, Learning Loop, Rule Refinement)"
      },
      "acceptance_criteria": [
        "=== TIER 1: BASIC BUNDLE GENERATION (Phase 1A - COMPLETE) ===",
        "✅ PatientNeedsProfile DTO with normalized assessment data",
        "✅ AssessmentIngestionService interface for HC/CA/BMHS merging",
        "✅ Assessment mappers for HC/CA with RUG classification",
        "✅ Episode type derivation rules (post_acute, complex_continuing, etc.)",
        "✅ Rehab potential score calculation (0-100 points)",
        "✅ Needs Cluster derivation for CA-only path",
        "✅ ScenarioAxis enum and ScenarioAxisSelector service",
        "✅ ScenarioBundleDTO and ScenarioServiceLine DTOs",
        "✅ Basic ScenarioGenerator with template-based bundles",
        "✅ CostAnnotationService with reference cap strategy",
        "✅ API endpoints (BundleEngineController)",
        "✅ React scenario selection UI in CareBundleWizard",
        "✅ RUG classification displayed correctly",
        "✅ UI refinements (Patient ID header, click behavior, etc.)",
        "",
        "=== PHASE 0: DATA EXPLORATION (COMPLETE) ===",
        "✅ 0.1 Query interrai_assessments to catalog actual assessment types",
        "✅ 0.2 Sample raw_items JSON to document available CA/HC item codes",
        "✅ 0.3 Document gaps between InterRAI spec and actual data",
        "✅ 0.4 Create docs/DATA_AVAILABILITY_AUDIT.md",
        "✅ 0.5 Identify authoritative InterRAI algorithm source",
        "✅ 0.6 Document path to algorithm verification",
        "",
        "=== PHASE 1: ENGINE INFRASTRUCTURE (COMPLETE) ===",
        "✅ 1.1 Create config/bundle_engine/ directory structure",
        "✅ 1.2 Implement DecisionTreeEngine (JSON interpreter)",
        "✅ 1.3 Create algorithm JSON schema + validator",
        "✅ 1.4 Implement CAPTriggerEngine (YAML interpreter)",
        "✅ 1.5 Create CAP trigger YAML schema + validator",
        "✅ 1.6 Implement ServiceIntensityResolver",
        "✅ 1.7 Create service_intensity_matrix.json with validation metadata",
        "✅ 1.8 Unit tests for engines (schema-driven)",
        "✅ 1.9 Create docs/ALGORITHM_DSL.md - formal DSL specification",
        "",
        "=== PHASE 2: CA ALGORITHM DEFINITIONS (COMPLETE) ===",
        "✅ 2.1 Define self_reliance_index.json + test cases",
        "✅ 2.2 Define assessment_urgency.json + test cases",
        "✅ 2.3 Define service_urgency.json + test cases",
        "✅ 2.4 Define rehabilitation.json + test cases",
        "✅ 2.5 Define personal_support.json + test cases",
        "✅ 2.6 Define distressed_mood.json + test cases",
        "✅ 2.7 Define pain_scale.json + test cases",
        "✅ 2.8 Define chess_ca.json + test cases",
        "✅ 2.9 Add CA algorithm scores to PatientNeedsProfile",
        "✅ 2.10 Create AlgorithmEvaluator service with CA→HC mapping",
        "✅ 2.11 Implement PatientNeedsProfile::toCAPInput() with all CAP-required fields",
        "✅ 2.12 Add getAlgorithmScoresSummary() for UI display",
        "⬜ 2.13 VERIFICATION GATE: Validate algorithms against authoritative source",
        "⬜ 2.14 Create algorithms/*.verified.json suffix convention",
        "",
        "=== PHASE 3: CAP TRIGGER DEFINITIONS (COMPLETE) ===",
        "✅ 3.1 Define adl.yaml (Functional)",
        "✅ 3.2 Define iadl.yaml (Functional)",
        "✅ 3.3 Define falls.yaml (Clinical) - already done in Phase 1",
        "✅ 3.4 Define pain.yaml (Clinical) - already done in Phase 1",
        "✅ 3.5 Define mood.yaml (Cognition/MH)",
        "✅ 3.6 Define cognitive_loss.yaml (Cognition/MH)",
        "✅ 3.7 Define informal_support.yaml (Social)",
        "✅ 3.8 Define pressure_ulcer.yaml (Clinical)",
        "✅ 3.9 Add FACILITATE trigger level to CAPTriggerEngine",
        "✅ 3.10 Test all 8 CAPs with sample profiles",
        "Note: Additional CAPs can be added as needed (bowel, continence, dehydration, etc.)",
        "",
        "=== PHASE 4: ENHANCED SCENARIO GENERATOR (COMPLETE) ===",
        "✅ 4.1 Update ScenarioGenerator to use ServiceIntensityResolver",
        "✅ 4.2 Add algorithm-driven service frequency calculation",
        "✅ 4.3 Add CAP-driven service recommendations (when HC available)",
        "✅ 4.4 Add algorithm/CAP-based clinical rationale to service lines",
        "✅ 4.5 Update AssessmentIngestionService to compute algorithm scores",
        "✅ 4.6 Integration test: Full assessment → algorithms → CAPs → scenarios flow",
        "Note: Scenarios now show algorithm scores (PSA 2/6, Pain 4/4) in rationale",
        "",
        "=== PHASE 5: VERTEX AI EXPLANATION (PARALLEL) ===",
        "⬜ 5.1 Create BundleExplanationPromptBuilder",
        "⬜ 5.2 Create BundleExplanationService",
        "⬜ 5.3 Implement PII masking for bundle context",
        "⬜ 5.4 Add explanation API endpoint",
        "⬜ 5.5 Add 'Explain This Bundle' UI button",
        "",
        "=== PHASE 6: BMHS INTEGRATION ===",
        "⬜ 6.1 Create BmhsAssessmentMapper",
        "⬜ 6.2 Map BMHS Section B (Disordered Thought)",
        "⬜ 6.3 Map BMHS Section C (Risk of Harm)",
        "⬜ 6.4 Add BMHS fields to PatientNeedsProfile",
        "⬜ 6.5 Create BMHS complexity algorithm in JSON",
        "",
        "=== PHASE 7: UI ENHANCEMENTS ===",
        "⬜ 7.1 Display algorithm scores on patient profile",
        "⬜ 7.2 Display triggered CAPs with care priorities",
        "⬜ 7.3 Show algorithm-driven rationale on service cards",
        "⬜ 7.4 Integrate AI explanation modal",
        "",
        "=== PHASE 8: LEARNING INFRASTRUCTURE ===",
        "⬜ 8.1 Design BigQuery schema: bundle_scenarios_generated",
        "⬜ 8.2 Design BigQuery schema: bundle_scenarios_selected",
        "⬜ 8.3 Design BigQuery schema: patient_outcomes",
        "⬜ 8.4 Create event emitters for scenario generation/selection",
        "⬜ 8.5 Create outcome tracking hooks",
        "⬜ 8.6 Document in docs/LEARNING_LOOP_ARCHITECTURE.md",
        "",
        "=== PHASE 9: LEARNING LOOP ===",
        "⬜ 9.1 Create ScenarioEffectivenessAnalyzer",
        "⬜ 9.2 Design scenario ranking model",
        "⬜ 9.3 Create RuleRefinementProposer (Vertex AI)",
        "⬜ 9.4 Design human review workflow for AI-proposed rule changes",
        "⬜ 9.5 Create admin UI for reviewing/accepting rule proposals",
        "⬜ 9.6 Document feedback loop process"
      ],
      "files": [
        "docs/CC21_AI_Bundle_Engine_Design.md",
        "docs/ALGORITHM_DSL.md",
        "docs/DATA_AVAILABILITY_AUDIT.md",
        "docs/LEARNING_LOOP_ARCHITECTURE.md",
        "config/bundle_engine/algorithms/*.json",
        "config/bundle_engine/cap_triggers/**/*.yaml",
        "config/bundle_engine/service_intensity_matrix.json",
        "app/Services/BundleEngine/Engines/DecisionTreeEngine.php",
        "app/Services/BundleEngine/Engines/CAPTriggerEngine.php",
        "app/Services/BundleEngine/Engines/ServiceIntensityResolver.php",
        "app/Services/BundleEngine/DTOs/PatientNeedsProfile.php",
        "app/Services/BundleEngine/DTOs/ScenarioBundleDTO.php",
        "app/Services/BundleEngine/DTOs/ScenarioServiceLine.php",
        "app/Services/BundleEngine/Enums/NeedsCluster.php",
        "app/Services/BundleEngine/Enums/ScenarioAxis.php",
        "app/Services/BundleEngine/Mappers/HcAssessmentMapper.php",
        "app/Services/BundleEngine/Mappers/CaAssessmentMapper.php",
        "app/Services/BundleEngine/Mappers/BmhsAssessmentMapper.php",
        "app/Services/BundleEngine/AssessmentIngestionService.php",
        "app/Services/BundleEngine/ScenarioAxisSelector.php",
        "app/Services/BundleEngine/CostAnnotationService.php",
        "app/Services/BundleEngine/ScenarioGenerator.php",
        "app/Services/BundleEngine/Llm/BundleExplanationService.php",
        "app/Providers/BundleEngineServiceProvider.php",
        "app/Http/Controllers/Api/V2/BundleEngineController.php",
        "resources/js/hooks/useBundleEngine.js",
        "resources/js/components/bundleEngine/*.jsx"
      ]
    }
  ],
  "metadata": {
    "project": "Connected Capacity 2.1",
    "last_updated": "2025-12-03",
    "version": "2.0.0"
  }
}